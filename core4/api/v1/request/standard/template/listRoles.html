<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<body>


<table style="width:80%">
    <tr>
        <th>Rolename</th>
        <th>Realname</th>
        <th>Permissions</th>
        <th>Email</th>
        <th>func</th>
    </tr>
    {% for i in roles %}
    <tr>
        <td style="text-align:center"><a
                href="/core4/api/v1/roles/{{ i['_id'] }}"> {{ i['name'] }} </a>
        </td>
        <td style="text-align:center">{{ i['realname'] }}</td>
        <td style="text-align:center">{{ i['perm'] }}</td>
        <td style="text-align:center">
            {% if 'email' in i.keys() %}
            {{ i['email'] }}
            {% else %}
            No email given
            {% end %}
        </td>
        <td style="text-align:center">
            <a href="/core4/api/v1/roles/{{ i['_id'] }}?edit=1"> EDIT </a>
            <button type="button" class="delete" data-user-id="{{ i['_id'] }}" data-etag="{{ i['etag'] }}"> DELETE</button>
        </td>
    </tr>
    {% end %}
</table>


<a href="/core4/api/v1/roles/create"> CREATE </a>

<div id="deletion"></div>

<script>
$( ".delete" ).click(function( event ) {
    event.preventDefault();
    console.log("inside function")
    var dataID = $( event.target ).data("user-id")
    var dataETAG = $( event.target ).data("etag")
  $.ajax({
    type: "DELETE",
    url: "./roles/" + dataID,
    data: {
      'etag': dataETAG
    },
    success: function( data ) {
      $( "#deletion" ).empty().append( '<span style="background-color: #00FF00">Sucessfully deleted role</span>' );
      window.setTimeout(function(){
      window.location.reload()
      },1000)
    },
    error: function( data ){
      $( "#deletion" ).empty().append( '<span style="background-color: #FF0000">Could not delete role</span>' );
    }
  });
});

</script>


</body>


</html>
